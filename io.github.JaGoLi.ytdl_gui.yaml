app-id: io.github.JaGoLi.ytdl_gui
runtime: org.kde.Platform
runtime-version: "5.15"
sdk: org.kde.Sdk
command: youtubedl-gui
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --share=network
  - --device=dri
  - --filesystem=home
modules:
  - name: x264
    config-opts:
      - --disable-cli
      - --enable-shared
    cleanup:
      - /include
    sources:
      - type: git
        url: https://code.videolan.org/videolan/x264.git
        branch: master
        commit: ae03d92b52bb7581df2e75d571989cb1ecd19cbd
  - name: ffmpeg
    config-opts:
      - --enable-gpl
      - --enable-nonfree
      - --disable-static
      - --enable-shared
      - --disable-debug
      - --disable-doc
      - --enable-libfdk-aac
      - --enable-libfreetype
      - --enable-libmp3lame
      - --enable-libopus
      - --enable-libtheora
      - --enable-libvorbis
      - --disable-programs
      - --disable-devices
    sources:
      - type: git
        url: https://git.ffmpeg.org/ffmpeg
        tag: n4.4
        commit: dc91b913b6260e85e1304c74ff7bb3c22a8c9fb1
  - python3-youtube-dl.json
  - name: youtubedl-gui
    buildsystem: cmake
    sources:
      - type: git
        url: https://github.com/JaGoLi/ytdl-gui.git
        tag: "3.0"
        commit: 6ea9ad84b476bf39e35cc3b2ed769c18152cbbda
        x-checker-data:
          type: git
          tag-pattern: (\d+\.\d+)
        disable-submodules: true
      - type: file
        path: io.github.JaGoLi.ytdl_gui.metainfo.xml
    post-install:
      - mv /app/share/icons/hicolor/64x64/apps/youtubedl-gui.png /app/share/icons/hicolor/64x64/apps/io.github.JaGoLi.ytdl_gui.png
      - mv /app/share/icons/hicolor/128x128/apps/youtubedl-gui.png /app/share/icons/hicolor/128x128/apps/io.github.JaGoLi.ytdl_gui.png
      - mv /app/share/icons/hicolor/256x256/apps/youtubedl-gui.png /app/share/icons/hicolor/256x256/apps/io.github.JaGoLi.ytdl_gui.png
      - mv /app/share/icons/hicolor/32x32/apps/youtubedl-gui.png /app/share/icons/hicolor/32x32/apps/io.github.JaGoLi.ytdl_gui.png
      - mv /app/share/icons/hicolor/512x512/apps/youtubedl-gui.png /app/share/icons/hicolor/512x512/apps/io.github.JaGoLi.ytdl_gui.png
      - mv /app/share/icons/hicolor/16x16/apps/youtubedl-gui.png /app/share/icons/hicolor/16x16/apps/io.github.JaGoLi.ytdl_gui.png
      - mv /app/share/applications/youtubedl-gui.desktop /app/share/applications/io.github.JaGoLi.ytdl_gui.desktop
      - sed -i '3d' /app/share/applications/io.github.JaGoLi.ytdl_gui.desktop
      - desktop-file-edit --set-key='Icon' --set-value='io.github.JaGoLi.ytdl_gui' /app/share/applications/io.github.JaGoLi.ytdl_gui.desktop
      - desktop-file-edit --set-key='Exec' --set-value='youtubedl-gui' /app/share/applications/io.github.JaGoLi.ytdl_gui.desktop
      - install -D io.github.JaGoLi.ytdl_gui.metainfo.xml -t /app/share/metainfo/
